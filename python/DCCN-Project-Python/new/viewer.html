<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Network Topology Demo — Viewer</title>
<style>
  :root{ --base:#faf4ed; --pine:#316a78; --muted:#6b646f; --rose:#e6b8c4; --surface:#fffaf6; --text:#2b2430; }
  html,body{ height:100vh; margin:0; background:var(--base); font-family:Inter,system-ui,sans-serif; color:var(--text); }
  .topnav{ position:fixed; top:0; left:0; right:0; padding:12px 48px; background:#f3ebe7; border-bottom:1px solid rgba(0,0,0,0.03); display:flex; align-items:center; justify-content:space-between; z-index:10; }
  .nav-links{ display:flex; gap:14px; }
  .nav-links a{ text-decoration:none; color:var(--pine); font-weight:600; }
  #main{ padding:88px 24px 24px 24px; display:flex; gap:18px; height:calc(100vh - 88px); box-sizing:border-box; }
  #canvas{ flex:1; background:var(--surface); border-radius:12px; padding:18px; box-shadow:0 10px 30px rgba(0,0,0,0.04); overflow:hidden; position:relative; }
  #sidebar{ width:320px; background:var(--surface); border-radius:12px; padding:12px; box-shadow:0 10px 30px rgba(0,0,0,0.04); overflow:auto; }
  h3{ margin:6px 0 12px 0; color:var(--pine); }
  pre{ font-size:12px; color:var(--muted); max-height:60vh; overflow:auto; background:transparent; border:none; padding:0; margin:0; }
</style>
</head>
<body>
  <nav class="topnav">
    <div style="font-weight:700; color:var(--pine)">Network Topology Demo</div>
    <div class="nav-links">
      <a href="/">Visualization</a>
      <a href="/upload">Upload</a>
      <a href="/files">Files</a>
    </div>
  </nav>

  <div id="main">
    <div id="canvas">
      <h3>Network Topology — Live</h3>
      <div id="graph" style="height:calc(100% - 36px); display:flex; align-items:center; justify-content:center;">
        <!-- placeholder: simple node-list -->
        <div id="nodes" style="text-align:center; font-weight:700; color:var(--muted)"></div>
      </div>
    </div>

    <div id="sidebar">
      <h3>Event Log</h3>
      <pre id="log">connecting...</pre>
    </div>
  </div>

<script>
  // connect to SSE
  const logEl = document.getElementById('log');
  const nodesEl = document.getElementById('nodes');
  const nodes = {}; // client => count
  const evtSrc = new EventSource('/events');
  evtSrc.onmessage = function(e){
    try {
      const obj = JSON.parse(e.data);
      const ts = obj.ts || new Date().toISOString();
      const line = (obj.type ? obj.type + " " : "") + JSON.stringify(obj.detail || obj);
      logEl.textContent = line + "\n" + logEl.textContent;
      // update nodes
      const key = (obj.detail && (obj.detail.client || obj.detail.ip)) || 'unknown';
      nodes[key] = (nodes[key] || 0) + 1;
      renderNodes();
    } catch (err){
      // ignore
    }
  };
  evtSrc.onerror = function(){
    logEl.textContent = "SSE disconnected\n" + logEl.textContent;
  };

  function renderNodes(){
    let html = "";
    Object.keys(nodes).forEach(k=>{
      html += `<div style="margin:8px 0;"><span style="display:inline-block;width:12px;height:12px;border-radius:12px;background:#2aa198;margin-right:8px;"></span>${k}</div>`;
    });
    nodesEl.innerHTML = html || "<span style='color:#9b9b9b'>no nodes yet</span>";
  }
</script>
</body>
</html>

